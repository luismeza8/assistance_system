{% load static %}

{% block head %}
  <title>{{ miembro.get_name }}</title>

{% endblock %}

{% block content %}
<body>
  {{ hours|json_script:'hours' }}
  <div class='flex justify-start'>
    <h1 class='px-4 mb-2 text-2xl font-bold'>Registros de {{ miembro.get_name }}</h1>
  </div>
  <div class='flex justify-center h-[600px]'>
    <canvas id='register_chart'></canvas>
  </div>
  <div class='above-table'>
    <h3>Total de registros: {{ registros|length }}</h3>
    <h3>Horas trabajadas: {{ miembro.get_time_worked_this_week }}</h3>
  </div>
  <table style='display: table !important;' class='custom-table'>
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Hora entrada</th>
        <th>Hora salida</th>
        <th>Tiempo trabajado</th>
      </tr>
    </thead>
    <tbody>
      {% for registro in registros %}
        <tr>
          <td>{{ registro.get_full_date }}</td>
          <td>{{ registro.check_in_time }}</td>
          {% if not registro.check_out_time %}
            <td>--:--</td>
          {% else %}
            <td>{{ registro.check_out_time }}</td>
          {% endif %}
          <td>{{ registro.time_worked }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table> 
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  (() => {
    const ctx = document.getElementById('register_chart');
    const value = JSON.parse(document.getElementById('hours').textContent);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado', 'Domingo'],
        datasets: [{
          label: 'Horas trabajadas cada dia',
          backgroundColor: '#1e1d4f',
          data: value,
        }]
      },
      options: {
        aspectRatio: 5,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  })();
  </script>
</body>
{% endblock %}
