{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
{% block head %}
{% endblock %}
  <title>Miembros</title>
</head>

{% block content %}

<div class='mb-[10px] flex flex-row justify-between items-center'>
  <h3 class='mx-4 text-md font-semibold'>Total de miembros: {{ miembros.count }}</h3>
  {% if user.is_admin %}
    <a hx-get='{% url 'agregar_miembro' %}' hx-target='#modal-place' class='add-button'>
        Agregar miembro
    </a>
  {% endif %}
</div>

<div id='modal-place'></div>

<table class='custom-table'>
  <thead>
    <tr>
      <!-- <th style='width: 4%;'>ID</th> -->
      <th style='padding: 0 1rem; width: 28%; text-align: start;'>Miembro</th>
      <th style='width: 12%;'>Rol</th>
      <th style='width: 10%;'>Horas trabajadas</th>
      <th style='width: 16%;'>Misiones</th>
      <th style='width: 16%'>Subsistemas</th>
      {% if user.is_admin %}
        <th style='width: 8%;'>Acciones</th>
      {% endif %}
    </tr>
  </thead>

  <tbody>
    {% for miembro in miembros %}
      <tr>
        <!-- <td>{{ miembro.pk }}</td> -->
        <td>
          <div class='flex items-center'>
            {% if miembro.profile_picture %}
              <div class='m-2 mx-4 h-12 w-12 bg-cover bg-center rounded-full shadow-3xl' 
                style='background-image: url({{ miembro.profile_picture.url }});'></div>
            {% endif %}
            {% if user.pk == miembro.pk or user.is_admin %}
              <a class='cursor-pointer hover:underline'
              hx-get='{% url 'registros' miembro.pk %}'
              hx-target='#content'
              hx-push-url='true'>
            {% endif %}
              <div class='flex flex-col justify-center items-start'>
                <div class='font-semibold'>{{ miembro.nombre }}</div>
                <div class='block text-xs'>{{ miembro.email }}</div>
              </div>
            </a>
          </div>
        </td>
        <td>
          {% if miembro.role == 'A' %}
            Administrador
          {% elif miembro.role == 'L' %}
            Lider
          {% else %}
            Miembro
          {% endif %}
        </td>
        <td>0 / {{ miembro.horas_acordadas }}</td>
        <td>
          {% for mision in miembro.mision.all %}
            {{ mision.nombre }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </td>
        <td>
          {% for subsistema in miembro.subsistema.all %}
            {{ subsistema.nombre }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </td>

        {% if user.is_admin %}
          <td class='flex flex-row items-center justify-center'>
            <a class='mx-2 cursor-pointer material-symbols-outlined' 
               hx-get='{% url 'editar_miembro' miembro.pk %}'
               hx-target='#modal-place'>
              edit_square
            </a>
            <a class='mx-2 cursor-pointer material-symbols-outlined' 
             hx-get='{% url 'eliminar_miembro' miembro.pk %}'
             hx-target='#modal-place'>
              delete
            </a>
          </td>
        {% endif %}

      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
</html>

